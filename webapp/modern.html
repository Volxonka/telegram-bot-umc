<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£–ú–¶ - –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ú–∏—Ä–æ–≤—ã—Ö –¶–∏–≤–∏–ª–∏–∑–∞—Ü–∏–π</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        @media (max-width: 640px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .grid-cols-1 {
                grid-template-columns: 1fr;
            }
            .flex-col {
                flex-direction: column;
            }
            .space-y-6 > * + * {
                margin-top: 1.5rem;
            }
            nav.flex {
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            nav button {
                white-space: nowrap;
            }
            .grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            .md\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
        }
        .active-tab {
            border-bottom: 3px solid #6366f1;
            color: #6366f1;
            font-weight: 500;
        }
        .schedule-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .expandable-content.expanded {
            max-height: 1000px;
            transition: max-height 0.3s ease-in;
        }
        .poll-option {
            transition: all 0.3s ease;
        }
        .poll-option:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        .poll-option.selected {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid #6366f1;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-gray-900 min-h-screen text-white">
    <div id="vanta-bg" class="fixed inset-0 z-0"></div>
    
    <div class="relative z-10 container mx-auto px-4 py-8">
        <!-- Header Section -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="flex items-center space-x-4 mb-6 md:mb-0">
                <div class="w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center">
                    <i data-feather="user" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 id="user-name" class="text-2xl font-bold">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                    <p id="user-group" class="text-indigo-200">–ì—Ä—É–ø–ø–∞: –ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
            <div class="glass-card rounded-xl p-4 flex items-center space-x-4">
                <div class="text-center">
                    <p class="text-sm text-indigo-200">–°—Ç–∞—Ç—É—Å</p>
                    <p id="user-role" class="text-2xl font-bold">–°—Ç—É–¥–µ–Ω—Ç</p>
                </div>
                <div class="h-8 w-px bg-gray-600"></div>
                <div class="text-center">
                    <p class="text-sm text-indigo-200">–ì—Ä—É–ø–ø–∞</p>
                    <p id="user-group-short" class="text-2xl font-bold">-</p>
                </div>
                <div class="h-8 w-px bg-gray-600"></div>
                <div class="text-center">
                    <p class="text-sm text-indigo-200">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                    <p class="text-2xl font-bold">–û–Ω–ª–∞–π–Ω</p>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex space-x-8 border-b border-gray-700 mb-8">
            <button class="pb-4 px-1 active-tab" data-tab="home">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="pb-4 px-1 hover:text-indigo-300 transition" data-tab="schedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
            <button class="pb-4 px-1 hover:text-indigo-300 transition" data-tab="polls">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</button>
            <button class="pb-4 px-1 hover:text-indigo-300 transition" data-tab="questions">–í–æ–ø—Ä–æ—Å—ã</button>
            <button class="pb-4 px-1 hover:text-indigo-300 transition" data-tab="messages">–°–æ–æ–±—â–µ–Ω–∏—è</button>
            <button class="pb-4 px-1 hover:text-indigo-300 transition hidden" data-tab="admin" id="admin-tab-btn">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
        </nav>

        <!-- Main Content -->
        <div id="content-container">
            <!-- Home Tab -->
            <div id="home-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Today's Schedule -->
                    <div class="glass-card rounded-xl p-6 lg:col-span-2">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold">–°–µ–≥–æ–¥–Ω—è</h2>
                            <button id="expand-schedule" class="flex items-center space-x-2 text-indigo-300 hover:text-indigo-200 transition">
                                <span>–í—Å–µ</span>
                                <i data-feather="chevron-right" class="w-4 h-4"></i>
                            </button>
                        </div>
                        
                        <div id="schedule-container" class="space-y-4">
                            <div class="loading-spinner text-center py-8">
                                <i data-feather="loader" class="w-8 h-8 mx-auto"></i>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</p>
                            </div>
                        </div>
                        
                        <div id="full-schedule" class="expandable-content">
                            <div class="mt-6 pt-6 border-t border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">–ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                                <div id="full-schedule-content" class="space-y-4">
                                    <!-- –ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions & Voting -->
                    <div class="space-y-6">
                        <div class="glass-card rounded-xl p-6">
                            <h2 class="text-xl font-bold mb-4">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="askQuestion()" class="bg-indigo-600 hover:bg-indigo-700 rounded-lg p-4 flex flex-col items-center justify-center transition">
                                    <i data-feather="message-square" class="w-6 h-6 mb-2"></i>
                                    <span>–í–æ–ø—Ä–æ—Å</span>
                                </button>
                                <button onclick="viewMessages()" class="bg-purple-600 hover:bg-purple-700 rounded-lg p-4 flex flex-col items-center justify-center transition">
                                    <i data-feather="mail" class="w-6 h-6 mb-2"></i>
                                    <span>–°–æ–æ–±—â–µ–Ω–∏—è</span>
                                </button>
                                <button onclick="viewPolls()" class="bg-pink-600 hover:bg-pink-700 rounded-lg p-4 flex flex-col items-center justify-center transition">
                                    <i data-feather="vote" class="w-6 h-6 mb-2"></i>
                                    <span>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</span>
                                </button>
                                <button onclick="viewSchedule()" class="bg-blue-600 hover:bg-blue-700 rounded-lg p-4 flex flex-col items-center justify-center transition">
                                    <i data-feather="calendar" class="w-6 h-6 mb-2"></i>
                                    <span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                                </button>
                            </div>
                        </div>

                        <div class="glass-card rounded-xl p-6">
                            <h2 class="text-xl font-bold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h2>
                            <div id="polls-container" class="space-y-4">
                                <div class="loading-spinner text-center py-4">
                                    <i data-feather="loader" class="w-6 h-6 mx-auto"></i>
                                    <p class="mt-2 text-sm">–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Tab -->
            <div id="schedule-tab" class="tab-content hidden">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-6">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                    <div id="full-schedule-tab" class="space-y-4">
                        <!-- –ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
                    </div>
                </div>
            </div>

            <!-- Polls Tab -->
            <div id="polls-tab" class="tab-content hidden">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-6">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h2>
                    <div id="all-polls-container" class="space-y-4">
                        <!-- –í—Å–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è -->
                    </div>
                </div>
            </div>

            <!-- Questions Tab -->
            <div id="questions-tab" class="tab-content hidden">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-6">–í–æ–ø—Ä–æ—Å—ã</h2>
                    <div class="mb-6">
                        <button onclick="askQuestion()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg transition">
                            <i data-feather="plus" class="w-4 h-4 inline mr-2"></i>
                            –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                    </div>
                    <div id="questions-container" class="space-y-4">
                        <!-- –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã -->
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="messages-tab" class="tab-content hidden">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-6">–°–æ–æ–±—â–µ–Ω–∏—è</h2>
                    <div id="messages-container" class="space-y-4">
                        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    </div>
                </div>
            </div>

            <!-- Admin Panel Tab -->
            <div id="admin-tab" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Quick Actions -->
                    <div class="glass-card rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-6">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="showCreateScheduleModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-lg transition">
                                <i data-feather="calendar" class="w-6 h-6 mx-auto mb-2"></i>
                                <span class="text-sm">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                            </button>
                            <button onclick="showCreatePollModal()" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg transition">
                                <i data-feather="vote" class="w-6 h-6 mx-auto mb-2"></i>
                                <span class="text-sm">–°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                            </button>
                            <button onclick="showCreateAnnouncementModal()" class="bg-yellow-600 hover:bg-yellow-700 text-white p-4 rounded-lg transition">
                                <i data-feather="megaphone" class="w-6 h-6 mx-auto mb-2"></i>
                                <span class="text-sm">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</span>
                            </button>
                            <button onclick="showManageStudentsModal()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg transition">
                                <i data-feather="users" class="w-6 h-6 mx-auto mb-2"></i>
                                <span class="text-sm">–°—Ç—É–¥–µ–Ω—Ç—ã</span>
                            </button>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="glass-card rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-6">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-indigo-400" id="total-students">0</div>
                                <div class="text-sm text-gray-400">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-400" id="active-polls">0</div>
                                <div class="text-sm text-gray-400">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-yellow-400" id="pending-questions">0</div>
                                <div class="text-sm text-gray-400">–í–æ–ø—Ä–æ—Å–æ–≤</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-400" id="total-announcements">0</div>
                                <div class="text-sm text-gray-400">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="glass-card rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-6">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                        <div id="admin-activity-container" class="space-y-3">
                            <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</h3>
            <textarea id="question-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..." class="w-full h-32 bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400 resize-none"></textarea>
            <div class="flex space-x-3 mt-4">
                <button onclick="submitQuestion()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 py-2 rounded-lg transition">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
                <button onclick="closeQuestionModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Modals -->
    <!-- Create Schedule Modal -->
    <div id="create-schedule-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
            <div class="space-y-4">
                <input type="text" id="schedule-subject" placeholder="–ü—Ä–µ–¥–º–µ—Ç" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <input type="text" id="schedule-teacher" placeholder="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <input type="text" id="schedule-room" placeholder="–ê—É–¥–∏—Ç–æ—Ä–∏—è" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <input type="text" id="schedule-time" placeholder="–í—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 09:00-10:30)" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <select id="schedule-day" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white">
                    <option value="–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                    <option value="–í—Ç–æ—Ä–Ω–∏–∫">–í—Ç–æ—Ä–Ω–∏–∫</option>
                    <option value="–°—Ä–µ–¥–∞">–°—Ä–µ–¥–∞</option>
                    <option value="–ß–µ—Ç–≤–µ—Ä–≥">–ß–µ—Ç–≤–µ—Ä–≥</option>
                    <option value="–ü—è—Ç–Ω–∏—Ü–∞">–ü—è—Ç–Ω–∏—Ü–∞</option>
                    <option value="–°—É–±–±–æ—Ç–∞">–°—É–±–±–æ—Ç–∞</option>
                </select>
            </div>
            <div class="flex space-x-3 mt-4">
                <button onclick="submitSchedule()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 py-2 rounded-lg transition">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
                <button onclick="closeCreateScheduleModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- Create Poll Modal -->
    <div id="create-poll-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
            <div class="space-y-4">
                <input type="text" id="poll-question" placeholder="–í–æ–ø—Ä–æ—Å –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <input type="number" id="poll-duration" placeholder="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)" value="10" min="1" max="60" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
            </div>
            <div class="flex space-x-3 mt-4">
                <button onclick="submitPoll()" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg transition">
                    –°–æ–∑–¥–∞—Ç—å
                </button>
                <button onclick="closeCreatePollModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div id="create-announcement-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>
            <div class="space-y-4">
                <input type="text" id="announcement-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" class="w-full bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400">
                <textarea id="announcement-content" placeholder="–¢–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è" class="w-full h-32 bg-gray-800 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400 resize-none"></textarea>
                <label class="flex items-center">
                    <input type="checkbox" id="announcement-important" class="mr-2">
                    <span class="text-white">–í–∞–∂–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</span>
                </label>
            </div>
            <div class="flex space-x-3 mt-4">
                <button onclick="submitAnnouncement()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 py-2 rounded-lg transition">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
                <button onclick="closeCreateAnnouncementModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram?.WebApp;
        if (!tg) {
            tg = {
                ready: () => {},
                expand: () => {},
                showAlert: (message) => alert(message),
                initDataUnsafe: {}
            };
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let currentGroup = null;
        let userRole = 'student';
        let allScheduleData = [];
        let allPollsData = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
                tg.ready();
                tg.expand();

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vanta.js —Ñ–æ–Ω–∞
                VANTA.NET({
                    el: "#vanta-bg",
                    mouseControls: true,
                    touchControls: true,
                    gyroControls: false,
                    minHeight: 200.00,
                    minWidth: 200.00,
                    scale: 1.00,
                    scaleMobile: 1.00,
                    color: 0x6366f1,
                    backgroundColor: 0x111827,
                    points: 10.00,
                    maxDistance: 22.00,
                    spacing: 18.00
                });

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
                feather.replace();

                // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.search);
                const user_id = urlParams.get('user_id');
                const group = urlParams.get('group');
                const username = urlParams.get('username');
                const full_name = urlParams.get('full_name');
                const is_curator = urlParams.get('is_curator') === 'true';

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                updateUserInfo(full_name, group, is_curator);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadAllData(user_id, group);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–æ–≤
                initializeTabs();

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ–º—ã—Ö —Å–µ–∫—Ü–∏–π
                initializeExpandableSections();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        }

        function updateUserInfo(fullName, group, isCurator) {
            document.getElementById('user-name').textContent = fullName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('user-group').textContent = `–ì—Ä—É–ø–ø–∞: ${group || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
            document.getElementById('user-role').textContent = isCurator ? '–ö—É—Ä–∞—Ç–æ—Ä' : '–°—Ç—É–¥–µ–Ω—Ç';
            document.getElementById('user-group-short').textContent = group || '-';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤
            const adminTabBtn = document.getElementById('admin-tab-btn');
            if (adminTabBtn) {
                if (isCurator) {
                    adminTabBtn.classList.remove('hidden');
                } else {
                    adminTabBtn.classList.add('hidden');
                }
            }
        }

        async function loadAllData(userId, group) {
            try {
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId, '–≥—Ä—É–ø–ø–∞:', group);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL –¥–ª—è API
                const baseUrl = window.location.origin;
                const apiUrl = `${baseUrl}/api/data?user_id=${userId}&group=${group}`;
                console.log('API URL:', apiUrl);
                
                const response = await fetch(apiUrl);
                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', result);
                
                if (result.status === 'success') {
                    const data = result.data;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    if (data.schedule && data.schedule.length > 0) {
                        allScheduleData = data.schedule;
                        displaySchedule(data.schedule, 'schedule-container');
                        displayFullSchedule(data.schedule, 'full-schedule-content');
                        displayFullSchedule(data.schedule, 'full-schedule-tab');
                    } else {
                        displaySchedule([], 'schedule-container');
                        displayFullSchedule([], 'full-schedule-content');
                        displayFullSchedule([], 'full-schedule-tab');
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                    if (data.polls && data.polls.length > 0) {
                        allPollsData = data.polls;
                        displayPolls(data.polls, 'polls-container');
                        displayAllPolls(data.polls, 'all-polls-container');
                    } else {
                        displayPolls([], 'polls-container');
                        displayAllPolls([], 'all-polls-container');
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
                    if (data.questions && data.questions.length > 0) {
                        displayQuestions(data.questions, 'questions-container');
                    } else {
                        displayQuestions([], 'questions-container');
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                    if (data.announcements && data.announcements.length > 0) {
                        displayMessages(data.announcements, 'messages-container');
                    } else {
                        displayMessages([], 'messages-container');
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞:', result);
                    showError(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
            }
        }

        function displaySchedule(schedule, containerId) {
            const container = document.getElementById(containerId);
            
            if (!schedule || schedule.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ<br><small>–ö—É—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</small></div>';
                return;
            }

            let html = '';
            schedule.slice(0, 3).forEach((item, index) => {
                const colors = ['bg-indigo-600', 'bg-purple-600', 'bg-pink-600'];
                const icons = ['book', 'code', 'cpu'];
                
                html += `
                    <div class="schedule-card bg-gray-800 bg-opacity-50 rounded-lg p-4 transition duration-300 fade-in">
                        <div class="flex items-start space-x-4">
                            <div class="${colors[index % colors.length]} rounded-lg p-3">
                                <i data-feather="${icons[index % icons.length]}" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold">${item.subject || '–ü—Ä–µ–¥–º–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω'}</h3>
                                <p class="text-sm text-gray-300">${item.time || '–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ'} ${item.room ? `| ${item.room}` : ''}</p>
                                <p class="text-sm text-gray-400 mt-1">${item.teacher || '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            feather.replace();
        }

        function displayFullSchedule(schedule, containerId) {
            const container = document.getElementById(containerId);
            
            if (!schedule || schedule.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</div>';
                return;
            }

            let html = '';
            schedule.forEach((item, index) => {
                const colors = ['bg-indigo-600', 'bg-purple-600', 'bg-pink-600', 'bg-green-600', 'bg-yellow-600'];
                const icons = ['book', 'code', 'cpu', 'database', 'layers'];
                
                html += `
                    <div class="schedule-card bg-gray-800 bg-opacity-50 rounded-lg p-4 transition duration-300 fade-in">
                        <div class="flex items-start space-x-4">
                            <div class="${colors[index % colors.length]} rounded-lg p-3">
                                <i data-feather="${icons[index % icons.length]}" class="w-5 h-5"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold">${item.subject || '–ü—Ä–µ–¥–º–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω'}</h3>
                                <p class="text-sm text-gray-300">${item.time || '–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ'} ${item.room ? `| ${item.room}` : ''}</p>
                                <p class="text-sm text-gray-400 mt-1">${item.teacher || '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                ${item.day ? `<p class="text-sm text-indigo-300 mt-1">üìÖ ${item.day}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            feather.replace();
        }

        function displayPolls(polls, containerId) {
            const container = document.getElementById(containerId);
            
            if (!polls || polls.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-400">üó≥Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</div>';
                return;
            }

            let html = '';
            polls.slice(0, 2).forEach(poll => {
                const isActive = poll.status === 'active';
                const userVote = poll.user_vote;
                
                html += `
                    <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 fade-in">
                        <h3 class="font-semibold mb-2">${poll.title}</h3>
                        ${isActive ? `
                            <div class="space-y-2">
                                <div class="poll-option flex items-center justify-between p-2 rounded cursor-pointer" data-poll="${poll.id}" data-option="present">
                                    <span>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é</span>
                                    <span class="text-sm text-gray-400">${poll.options[0]?.votes || 0}</span>
                                </div>
                                <div class="poll-option flex items-center justify-between p-2 rounded cursor-pointer" data-poll="${poll.id}" data-option="absent">
                                    <span>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é</span>
                                    <span class="text-sm text-gray-400">${poll.options[1]?.votes || 0}</span>
                                </div>
                            </div>
                            <button onclick="votePoll(${poll.id})" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 py-2 rounded-lg transition text-sm">
                                ${userVote ? '–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ–ª–æ—Å' : '–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å'}
                            </button>
                        ` : `
                            <div class="space-y-2">
                                <div class="flex items-center justify-between">
                                    <span>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
                                    <div class="w-24 bg-gray-700 rounded-full h-2">
                                        <div class="bg-indigo-500 h-2 rounded-full" style="width: ${poll.options[0]?.votes || 0}%"></div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
                                    <div class="w-24 bg-gray-700 rounded-full h-2">
                                        <div class="bg-indigo-500 h-2 rounded-full" style="width: ${poll.options[1]?.votes || 0}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 text-center text-sm text-gray-400">
                                –í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ${poll.total_votes}
                            </div>
                        `}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayAllPolls(polls, containerId) {
            const container = document.getElementById(containerId);
            
            if (!polls || polls.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">üó≥Ô∏è –ù–µ—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</div>';
                return;
            }

            let html = '';
            polls.forEach(poll => {
                const isActive = poll.status === 'active';
                const userVote = poll.user_vote;
                
                html += `
                    <div class="bg-gray-800 bg-opacity-50 rounded-lg p-6 fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-semibold text-lg">${poll.title}</h3>
                            <span class="px-3 py-1 rounded-full text-xs ${isActive ? 'bg-green-600' : 'bg-gray-600'}">
                                ${isActive ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'}
                            </span>
                        </div>
                        ${isActive ? `
                            <div class="space-y-3">
                                <div class="poll-option flex items-center justify-between p-3 rounded cursor-pointer border border-gray-600" data-poll="${poll.id}" data-option="present">
                                    <span>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é</span>
                                    <span class="text-sm text-gray-400">${poll.options[0]?.votes || 0}</span>
                                </div>
                                <div class="poll-option flex items-center justify-between p-3 rounded cursor-pointer border border-gray-600" data-poll="${poll.id}" data-option="absent">
                                    <span>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é</span>
                                    <span class="text-sm text-gray-400">${poll.options[1]?.votes || 0}</span>
                                </div>
                            </div>
                            <button onclick="votePoll(${poll.id})" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 py-3 rounded-lg transition">
                                ${userVote ? '–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ–ª–æ—Å' : '–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å'}
                            </button>
                        ` : `
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span>‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
                                    <div class="w-32 bg-gray-700 rounded-full h-3">
                                        <div class="bg-indigo-500 h-3 rounded-full" style="width: ${poll.options[0]?.votes || 0}%"></div>
                                    </div>
                                    <span class="text-sm text-gray-400">${poll.options[0]?.votes || 0}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
                                    <div class="w-32 bg-gray-700 rounded-full h-3">
                                        <div class="bg-indigo-500 h-3 rounded-full" style="width: ${poll.options[1]?.votes || 0}%"></div>
                                    </div>
                                    <span class="text-sm text-gray-400">${poll.options[1]?.votes || 0}</span>
                                </div>
                            </div>
                            <div class="mt-4 text-center text-sm text-gray-400">
                                –í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ${poll.total_votes}
                            </div>
                        `}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayQuestions(questions, containerId) {
            const container = document.getElementById(containerId);
            
            if (!questions || questions.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">‚ùì –ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</div>';
                return;
            }

            let html = '';
            questions.forEach(question => {
                html += `
                    <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 fade-in">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">–í–æ–ø—Ä–æ—Å #${question.id}</h3>
                            <span class="px-2 py-1 rounded text-xs ${question.status === 'answered' ? 'bg-green-600' : 'bg-yellow-600'}">
                                ${question.status === 'answered' ? '–û—Ç–≤–µ—á–µ–Ω' : '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞'}
                            </span>
                        </div>
                        <p class="text-gray-300 mb-3">${question.question}</p>
                        ${question.answer ? `
                            <div class="bg-gray-700 bg-opacity-50 rounded p-3">
                                <p class="text-sm text-gray-400 mb-1">–û—Ç–≤–µ—Ç:</p>
                                <p class="text-white">${question.answer}</p>
                            </div>
                        ` : ''}
                        <p class="text-xs text-gray-500 mt-2">${question.time}</p>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayMessages(messages, containerId) {
            const container = document.getElementById(containerId);
            
            if (!messages || messages.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">üì® –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
                return;
            }

            let html = '';
            messages.forEach(message => {
                html += `
                    <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 fade-in">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${message.title}</h3>
                            <span class="px-2 py-1 rounded text-xs ${message.priority === 'high' ? 'bg-red-600' : 'bg-blue-600'}">
                                ${message.priority === 'high' ? '–í–∞–∂–Ω–æ' : '–û–±—ã—á–Ω–æ–µ'}
                            </span>
                        </div>
                        <p class="text-gray-300 mb-3">${message.content}</p>
                        <div class="flex justify-between items-center text-xs text-gray-500">
                            <span>–û—Ç: ${message.author}</span>
                            <span>${message.time}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function initializeTabs() {
            const tabs = document.querySelectorAll('nav button[data-tab]');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
                    tabs.forEach(t => t.classList.remove('active-tab'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ç–µ–∫—É—â–µ–º—É —Ç–∞–±—É
                    this.classList.add('active-tab');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
                    tabContents.forEach(content => content.classList.add('hidden'));
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
                });
            });
        }

        function initializeExpandableSections() {
            const expandButtons = document.querySelectorAll('[id^="expand-"]');
            
            expandButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.id.replace('expand-', '');
                    const content = document.getElementById(targetId);
                    const icon = this.querySelector('i');
                    
                    if (content.classList.contains('expanded')) {
                        content.classList.remove('expanded');
                        icon.style.transform = 'rotate(0deg)';
                        this.querySelector('span').textContent = '–í—Å–µ';
                    } else {
                        content.classList.add('expanded');
                        icon.style.transform = 'rotate(90deg)';
                        this.querySelector('span').textContent = '–°–∫—Ä—ã—Ç—å';
                    }
                });
            });
        }

        async function votePoll(pollId) {
            try {
                const selectedOption = document.querySelector(`[data-poll="${pollId}"].selected`);
                if (!selectedOption) {
                    tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞');
                    return;
                }

                const vote = selectedOption.getAttribute('data-option');
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');

                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/polls/${pollId}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        vote: vote
                    })
                });

                if (response.ok) {
                    tg.showAlert('–ì–æ–ª–æ—Å –∑–∞—Å—á–∏—Ç–∞–Ω!');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadAllData(userId, urlParams.get('group'));
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
            }
        }

        function askQuestion() {
            document.getElementById('question-modal').classList.remove('hidden');
        }

        function closeQuestionModal() {
            document.getElementById('question-modal').classList.add('hidden');
            document.getElementById('question-text').value = '';
        }

        async function submitQuestion() {
            const questionText = document.getElementById('question-text').value.trim();
            if (!questionText) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞');
                return;
            }

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');
                const group = urlParams.get('group');

                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        group: group,
                        question: questionText
                    })
                });

                if (response.ok) {
                    tg.showAlert('–í–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                    closeQuestionModal();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadAllData(userId, group);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–æ–ø—Ä–æ—Å–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–æ–ø—Ä–æ—Å–∞');
            }
        }

        function viewMessages() {
            document.querySelector('[data-tab="messages"]').click();
        }

        function viewPolls() {
            document.querySelector('[data-tab="polls"]').click();
        }

        function viewSchedule() {
            document.querySelector('[data-tab="schedule"]').click();
        }

        function showError(message) {
            document.body.innerHTML = `
                <div class="container mx-auto px-4 py-8">
                    <div class="glass-card rounded-xl p-6 text-center">
                        <h2 class="text-xl font-bold mb-4">–û—à–∏–±–∫–∞</h2>
                        <p class="text-gray-300">${message}</p>
                    </div>
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–π –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è—Ö
        document.addEventListener('click', function(e) {
            if (e.target.closest('.poll-option')) {
                const option = e.target.closest('.poll-option');
                const pollId = option.getAttribute('data-poll');
                
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –æ–ø—Ü–∏–π —ç—Ç–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                document.querySelectorAll(`[data-poll="${pollId}"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –æ–ø—Ü–∏—é
                option.classList.add('selected');
            }
        });

        // Admin Panel Functions
        function showCreateScheduleModal() {
            document.getElementById('create-schedule-modal').classList.remove('hidden');
        }

        function closeCreateScheduleModal() {
            document.getElementById('create-schedule-modal').classList.add('hidden');
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('schedule-subject').value = '';
            document.getElementById('schedule-teacher').value = '';
            document.getElementById('schedule-room').value = '';
            document.getElementById('schedule-time').value = '';
            document.getElementById('schedule-day').value = '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫';
        }

        function showCreatePollModal() {
            document.getElementById('create-poll-modal').classList.remove('hidden');
        }

        function closeCreatePollModal() {
            document.getElementById('create-poll-modal').classList.add('hidden');
            document.getElementById('poll-question').value = '';
            document.getElementById('poll-duration').value = '10';
        }

        function showCreateAnnouncementModal() {
            document.getElementById('create-announcement-modal').classList.remove('hidden');
        }

        function closeCreateAnnouncementModal() {
            document.getElementById('create-announcement-modal').classList.add('hidden');
            document.getElementById('announcement-title').value = '';
            document.getElementById('announcement-content').value = '';
            document.getElementById('announcement-important').checked = false;
        }

        function showManageStudentsModal() {
            tg.showAlert('–§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        async function submitSchedule() {
            const subject = document.getElementById('schedule-subject').value.trim();
            const teacher = document.getElementById('schedule-teacher').value.trim();
            const room = document.getElementById('schedule-room').value.trim();
            const time = document.getElementById('schedule-time').value.trim();
            const day = document.getElementById('schedule-day').value;

            if (!subject || !teacher || !time) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');
                const group = urlParams.get('group');

                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/schedule`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        group: group,
                        subject: subject,
                        teacher: teacher,
                        room: room,
                        time: time,
                        day: day
                    })
                });

                const result = await response.json();
                if (result.status === 'success') {
                    tg.showAlert('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
                    closeCreateScheduleModal();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadAllData(userId, group);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
            }
        }

        async function submitPoll() {
            const question = document.getElementById('poll-question').value.trim();
            const duration = parseInt(document.getElementById('poll-duration').value);

            if (!question) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
                return;
            }

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');
                const group = urlParams.get('group');

                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/polls`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        group: group,
                        question: question,
                        duration: duration
                    })
                });

                const result = await response.json();
                if (result.status === 'success') {
                    tg.showAlert('–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
                    closeCreatePollModal();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadAllData(userId, group);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
            }
        }

        async function submitAnnouncement() {
            const title = document.getElementById('announcement-title').value.trim();
            const content = document.getElementById('announcement-content').value.trim();
            const important = document.getElementById('announcement-important').checked;

            if (!title || !content) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
                return;
            }

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');
                const group = urlParams.get('group');

                const baseUrl = window.location.origin;
                const response = await fetch(`${baseUrl}/api/announcements`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        group: group,
                        title: title,
                        content: content,
                        important: important
                    })
                });

                const result = await response.json();
                if (result.status === 'success') {
                    tg.showAlert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    closeCreateAnnouncementModal();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadAllData(userId, group);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
            }
        }
    </script>
</body>
</html>
